var documenterSearchIndex = {"docs":
[{"location":"","page":"Home","title":"Home","text":"CurrentModule = SMLMFrameConnection","category":"page"},{"location":"#SMLMFrameConnection","page":"Home","title":"SMLMFrameConnection","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Frame-connection for 2D single molecule localization microscopy (SMLM) data: linking localizations from the same fluorophore blinking event across consecutive frames into single, higher-precision localizations. Uses spatiotemporal LAP assignment to optimally connect temporally adjacent detections based on spatial proximity and estimated blinking kinetics. See Schodt & Lidke 2021.","category":"page"},{"location":"#Installation","page":"Home","title":"Installation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"using Pkg\nPkg.add(\"SMLMFrameConnection\")","category":"page"},{"location":"#Quick-Start","page":"Home","title":"Quick Start","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"using SMLMFrameConnection\n\n# Run frame connection on your BasicSMLD with Emitter2DFit emitters\n(combined, info) = frameconnect(smld)\n\n# combined is the main output - higher precision localizations\n# info contains track assignments and algorithm metadata","category":"page"},{"location":"#Input-Requirements","page":"Home","title":"Input Requirements","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Input BasicSMLD must contain Emitter2DFit emitters with:","category":"page"},{"location":"","page":"Home","title":"Home","text":"Required:","category":"page"},{"location":"","page":"Home","title":"Home","text":"x, y: Position coordinates (microns)\nσ_x, σ_y: Position uncertainties (microns) - must be > 0 for MLE weighting\nframe: Frame number (1-based)","category":"page"},{"location":"","page":"Home","title":"Home","text":"Optional:","category":"page"},{"location":"","page":"Home","title":"Home","text":"photons, bg: Photometry (summed in output)\ndataset: Dataset identifier (default: 1)","category":"page"},{"location":"#Algorithm-Overview","page":"Home","title":"Algorithm Overview","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Preclustering: Groups spatially and temporally adjacent localizations into candidate clusters\nParameter Estimation: Estimates fluorophore blinking kinetics (k_on, k_off, k_bleach) and emitter density from the data\nFrame Connection: Uses Linear Assignment Problem (LAP) to optimally assign localizations to emitters based on spatial proximity and estimated photophysics\nCombination: Combines connected localizations using MLE weighted mean for improved precision","category":"page"},{"location":"#Outputs","page":"Home","title":"Outputs","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Output Description\ncombined Main output - combined high-precision localizations\ninfo.connected Original localizations with track_id assigned\ninfo.n_tracks Number of tracks formed\ninfo.elapsed_s Wall time in seconds","category":"page"},{"location":"#Parameters","page":"Home","title":"Parameters","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"frameconnect(smld;\n    n_density_neighbors = 2,   # Clusters for density estimation\n    max_sigma_dist = 5.0,        # Distance threshold multiplier\n    max_frame_gap = 5,        # Max frame gap for connections\n    max_neighbors = 2              # Nearest neighbors for preclustering\n)","category":"page"},{"location":"","page":"Home","title":"Home","text":"max_sigma_dist: Higher values allow connections over larger distances\nmax_frame_gap: Increase for dyes with long dark states (dSTORM: 10-20)","category":"page"},{"location":"#API-Reference","page":"Home","title":"API Reference","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"","category":"page"},{"location":"","page":"Home","title":"Home","text":"Modules = [SMLMFrameConnection]","category":"page"},{"location":"#SMLMFrameConnection.FrameConnectConfig","page":"Home","title":"SMLMFrameConnection.FrameConnectConfig","text":"FrameConnectConfig\n\nConfiguration parameters for frame connection algorithm.\n\nFields\n\nn_density_neighbors::Int=2: Number of nearest preclusters used for local density                            estimates (see estimatedensities)\nmax_sigma_dist::Float64=5.0: Multiplier of localization errors that defines a                           pre-clustering distance threshold (see precluster)\nmax_frame_gap::Int=5: Maximum frame gap between temporally adjacent localizations                       in a precluster (see precluster)\nmax_neighbors::Int=2: Maximum number of nearest-neighbors inspected for precluster                  membership (see precluster)\n\nExample\n\n# Using default config\nconfig = FrameConnectConfig()\n(combined, info) = frameconnect(smld, config)\n\n# Custom config\nconfig = FrameConnectConfig(max_frame_gap=10, max_sigma_dist=3.0)\n(combined, info) = frameconnect(smld, config)\n\n# Kwargs form (equivalent to Config form)\n(combined, info) = frameconnect(smld; max_frame_gap=10, max_sigma_dist=3.0)\n\n\n\n\n\n","category":"type"},{"location":"#SMLMFrameConnection.FrameConnectInfo","page":"Home","title":"SMLMFrameConnection.FrameConnectInfo","text":"FrameConnectInfo{T}\n\nSecondary output from frameconnect() containing track assignments and algorithm metadata.\n\nFields\n\nconnected::BasicSMLD{T}: Input SMLD with track_id assigned (localizations uncombined)\nn_input::Int: Number of input localizations\nn_tracks::Int: Number of tracks formed\nn_combined::Int: Number of output localizations\nk_on::Float64: Estimated on rate (1/frame)\nk_off::Float64: Estimated off rate (1/frame)\nk_bleach::Float64: Estimated bleach rate (1/frame)\np_miss::Float64: Probability of missed detection\ninitial_density::Vector{Float64}: Initial density estimate per cluster (emitters/μm²)\nelapsed_s::Float64: Wall time in seconds\nalgorithm::Symbol: Algorithm used (:lap)\nn_preclusters::Int: Number of preclusters formed\n\nRate Parameter Interpretation\n\nThe rate parameters describe the photophysics of blinking fluorophores:\n\nk_on: Rate at which dark emitters convert to visible state\nk_off: Rate at which visible emitters convert to reversible dark state\nk_bleach: Rate at which visible emitters are irreversibly photobleached\nDuty cycle = kon / (kon + k_off)\nFor typical dSTORM: kon << koff (low duty cycle, mostly dark with brief blinks)\n\nExample\n\n(combined, info) = frameconnect(smld)\nprintln(\"Connected $(info.n_input) → $(info.n_combined) localizations\")\nprintln(\"Formed $(info.n_tracks) tracks in $(info.elapsed_s)s\")\n# Access track assignments via info.connected\n\n\n\n\n\n","category":"type"},{"location":"#SMLMFrameConnection.ParamStruct","page":"Home","title":"SMLMFrameConnection.ParamStruct","text":"ParamStruct(initial_density::Vector{Float64},\n    k_on::Float64, k_off::Float64, k_bleach::Float64, p_miss::Float64,\n    max_sigma_dist::Float64, max_frame_gap::Int, n_density_neighbors::Int)\n\nStructure of parameters needed for frame-connection.\n\nFields\n\ninitial_density: Density of emitters at the start of the experiment.                   (see estimatedensities()) (emitters/μm²)\nn_density_neighbors: Number of nearest preclusters used for local density                      estimates. (default = 2)(see estimatedensities())\nk_on: Rate at which dark emitters convert to the visible state (1/frame).\nk_off: Rate at which visible emitters convert to the reversible dark state (1/frame).\nk_bleach: Rate at which visible emitters are irreversibly photobleached (1/frame).\np_miss: Probability of missing a localization of a visible emitter.\nmax_sigma_dist: Multiplier of localization errors that defines a pre-clustering              distance threshold. (default = 5)(see precluster())(unitless)\nmax_frame_gap: Maximum frame gap between temporally adjacent localizations in                a precluster. (default = 5)(see precluster())(frames)\nmax_neighbors: Maximum number of nearest-neighbors inspected for precluster           membership.  Ideally, this would be set to inf, but that's not           feasible for most data. (default = 2)(see precluster())\n\nNote: kon, koff, and kbleach are transition rates, not duty cycle fractions. The duty cycle (fraction of time in ON state) is kon/(kon + koff). For typical dSTORM, kon << koff gives low duty cycle (mostly dark, brief blinks).\n\n\n\n\n\n","category":"type"},{"location":"#SMLMFrameConnection.combinelocalizations-Union{Tuple{SMLMData.BasicSMLD{T, E}}, Tuple{E}, Tuple{T}} where {T, E<:SMLMData.AbstractEmitter}","page":"Home","title":"SMLMFrameConnection.combinelocalizations","text":"smld_combined = combinelocalizations(smld::BasicSMLD{T,E}) where {T, E<:SMLMData.AbstractEmitter}\n\nCombine clustered localizations in smld into higher precision localizations.\n\nDescription\n\nThis function combines localizations in smld that share the same value of track_id.  Localizations are combined assuming they arose from independent measurements of the same position with Gaussian errors.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.compress_connectID!-Tuple{Vector{Int64}}","page":"Home","title":"SMLMFrameConnection.compress_connectID!","text":"compress_connectID!(connectID::Vector{Int32})\n\nMake connectID consists of the set of integers 1:length(unique(connectID))`\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.compress_connectID-Tuple{Vector{Int64}}","page":"Home","title":"SMLMFrameConnection.compress_connectID","text":"connectID = compress_connectID(connectID::Vector{Int32})\n\nMake connectID consists of the set of integers 1:length(unique(connectID))`\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.computeclusterinfo-Tuple{Vector{Matrix{Float32}}}","page":"Home","title":"SMLMFrameConnection.computeclusterinfo","text":"clusterdurations, nobservations = \n    computeclusterinfo(clusterdata::Vector{Matrix{Float32}})\n\nCompute the durations of and number of member localizations in clusters.\n\nDescription\n\nThis method computes the duration of each cluster and the number of localizations in each cluster present in the input clusterdata.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.connect1DS-Union{Tuple{E}, Tuple{T}, Tuple{SMLMData.BasicSMLD{T, E}, Int64, Vector{Int64}, Int64}} where {T, E<:SMLMData.AbstractEmitter}","page":"Home","title":"SMLMFrameConnection.connect1DS","text":"connect1DS(smld::BasicSMLD{T,E}, dataset::Int,\n           connectID::Vector{Int}, maxID::Int;\n           max_frame_gap::Int = 5) where {T, E<:SMLMData.AbstractEmitter}\n\nDefine the \"ideal\" frame-connection result for simulated smld with one dataset.\n\nDescription\n\nThis is a helper function which defines the ideal FC result for a single dataset.  The user should probably not bother using this, and instead should call defineidealFC().\n\nInputs\n\nsmld: BasicSMLD with track_id populated to indicate emitter ID.\ndataset: Dataset number to be connected.\nconnectID: Current connection IDs for all emitters.\nmaxID: Current maximum ID value.\nmax_frame_gap: Maximum frame gap allowed between localizations connected in                the \"ideal\" result.\n\nReturns\n\nUpdated connectID array and new maxID.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.connectlocalizations!-Tuple{Vector{Int64}, Vector{Matrix{Float32}}, ParamStruct, Int64}","page":"Home","title":"SMLMFrameConnection.connectlocalizations!","text":"connectlocalizations!(connectID::Vector{Int64},\n    clusterdata::Vector{Matrix{Float32}},\n    params::ParamStruct, nframes::Int64)\n\nConnect localizations in clusterdata by solving a linear assignment problem.\n\nDescription\n\nConnect localizations in clusterdata by giving \"connected\" localizations the same integer value for their field smd.connectID.  Associations are made by solving a linear assignment problem which designates the ideal connections between localizations.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.connectlocalizations-Tuple{Vector{Int64}, Vector{Matrix{Float32}}, ParamStruct, Int64}","page":"Home","title":"SMLMFrameConnection.connectlocalizations","text":"connectID = connectlocalizations(connectID::Vector{Int64}, \n    clusterdata::Vector{Matrix{Float32}}, \n    params::ParamStruct, nframes::Int64)\n\nConnect localizations in clusterdata by solving a linear assignment problem.\n\nDescription\n\nConnect localizations in clusterdata by giving \"connected\" localizations the same integer value for their field smd.connectID.  Associations are made by solving a linear assignment problem which designates the ideal connections between localizations.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.create_costmatrix-Tuple{Vector{Matrix{Float32}}, ParamStruct, Int64, Int64}","page":"Home","title":"SMLMFrameConnection.create_costmatrix","text":"costmatrix = create_costmatrix(clusterdata::Vector{Matrix{Float32}}, \n    params::ParamStruct, nframes::Int64)\n\nCreate a cost matrix for connections between localizations in clusterdata.\n\nDescription\n\nThe costs associated with connecting/not connecting the localizations in the input set of data in clusterdata are placed in entries of the output matrix costmatrix.  For N localizations in clusterdata, the output costmatrix will be an 2Nx2N block matrix.  The NxN blocks are attributed the following meanings: the upper-left \"connection\" block corresponds to adding localizations to existing clusters of other localizations, the bottom-left \"birth\" block  corresponds to introduction of a new cluster, and the upper-right \"death\" block corresponds to preventing admission of any more localizations to a cluster. The bottom-right \"auxillary\" block is the transpose of the \"connection\" block. Forbidden connections are indicated by missing.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.defineidealFC-Union{Tuple{SMLMData.BasicSMLD{T, E}}, Tuple{E}, Tuple{T}} where {T, E<:SMLMData.AbstractEmitter}","page":"Home","title":"SMLMFrameConnection.defineidealFC","text":"smld_connected, smld_combined = defineidealFC(\n    smld::BasicSMLD{T,E};\n    max_frame_gap::Int = 5) where {T, E<:SMLMData.AbstractEmitter}\n\nDefine the \"ideal\" frame-connection result for a simulated smld.\n\nDescription\n\nThis function defines the \"ideal\" frame connection result from a simulation. That is to say, for a simulated BasicSMLD structure smld with track_id field populated to indicate emitter membership of localizations, this function will generate an \"ideal\" FC result which combines all blinking events that appeared with frame gaps less than max_frame_gap of one another.  Note that for very high duty cycles, multiple blinking events might be mistakingly combined by this method (i.e., if the emitter blinks back on within max_frame_gap frames of its previous blink).  Note that localizations are not allowed to be connected across datasets.\n\nInputs\n\nsmld: BasicSMLD with track_id populated to indicate emitter ID.\nmax_frame_gap: Maximum frame gap allowed between localizations connected in                the \"ideal\" result.\n\nOutputs\n\nsmld_connected: Copy of the input smld with track_id modified to reflect                   blinking event ID.\nsmld_combined: Ideal frame-connection result with localizations combined.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.estimatedensities-Union{Tuple{E}, Tuple{T}, Tuple{SMLMData.BasicSMLD{T, E}, Vector{Matrix{Float32}}, ParamStruct}} where {T, E<:SMLMData.AbstractEmitter}","page":"Home","title":"SMLMFrameConnection.estimatedensities","text":"initial_density = estimatedensities(smld::BasicSMLD{T,E},\n    clusterdata::Vector{Matrix{Float32}}, params::ParamStruct) where {T, E<:SMLMData.AbstractEmitter}\n\nEstimate local emitter densities for clusters in smld and clusterdata.\n\nDescription\n\nThe initial local densities initial_density around each pre-cluster present in smld/clusterdata are estimated based on the local density of pre-clusters throughout the entire set of data as well as some of the rate parameters provided in params.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.estimateparams-Union{Tuple{E}, Tuple{T}, Tuple{SMLMData.BasicSMLD{T, E}, Vector{Matrix{Float32}}}} where {T, E<:SMLMData.AbstractEmitter}","page":"Home","title":"SMLMFrameConnection.estimateparams","text":"k_on, k_off, k_bleach, p_miss, nemitters =\n    estimateparams(smld::BasicSMLD{T,E},\n                   clusterdata::Vector{Matrix{Float32}}) where {T, E<:SMLMData.AbstractEmitter}\n\nEstimate rate parameters from the clusters in smld and clusterdata.\n\nDescription\n\nThe rate parameters k_on, k_off, and k_bleach, the probability of missing a localization for a visible emitter p_miss, and the underlying number of emitters nemitters are estimated from the pre-clusters in smld/clusterdata.  This is done by assuming that pre-clusters are, on average, representative of a single blinking event of a single emitter.\n\nCitation\n\nSchodt David J., Lidke Keith A., \"Spatiotemporal Clustering of Repeated Super-Resolution Localizations via Linear Assignment Problem\", Front. Bioinform., 20 October 2021 https://doi.org/10.3389/fbinf.2021.724325\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.frameconnect-Union{Tuple{SMLMData.BasicSMLD{T, E}}, Tuple{E}, Tuple{T}} where {T, E<:SMLMData.AbstractEmitter}","page":"Home","title":"SMLMFrameConnection.frameconnect","text":"(combined, info) = frameconnect(smld::BasicSMLD, config::FrameConnectConfig)\n(combined, info) = frameconnect(smld::BasicSMLD; kwargs...)\n\nConnect repeated localizations of the same emitter in smld.\n\nDescription\n\nRepeated localizations of the same emitter present in smld are connected and combined into higher precision localizations of that emitter. This is done by\n\nforming pre-clusters of localizations, 2) estimating rate parameters from\n\nthe pre-clusters, 3) solving a linear assignment problem for connecting localizations in each pre-cluster, and 4) combining the connected localizations using their MLE position estimate assuming Gaussian noise.\n\nArguments\n\nsmld::BasicSMLD: Localizations to connect. Must contain emitters with valid                    position uncertainties (σx, σy).\nconfig::FrameConnectConfig: Configuration parameters (optional, can use kwargs instead)\n\nKeyword Arguments (equivalent to FrameConnectConfig fields)\n\nn_density_neighbors::Int=2: Number of nearest preclusters used for local density                            estimates (see estimatedensities)\nmax_sigma_dist::Float64=5.0: Multiplier of localization errors that defines a                           pre-clustering distance threshold (see precluster)\nmax_frame_gap::Int=5: Maximum frame gap between temporally adjacent localizations                       in a precluster (see precluster)\nmax_neighbors::Int=2: Maximum number of nearest-neighbors inspected for precluster                  membership (see precluster)\n\nReturns\n\nA tuple (combined, info):\n\ncombined::BasicSMLD: Connected localizations combined into higher precision results\ninfo::FrameConnectInfo: Track assignments and algorithm metadata (see FrameConnectInfo)\n\nExample\n\n# Using kwargs (most common)\n(combined, info) = frameconnect(smld)\n(combined, info) = frameconnect(smld; max_frame_gap=10)\n\n# Using config struct\nconfig = FrameConnectConfig(max_frame_gap=10, max_sigma_dist=3.0)\n(combined, info) = frameconnect(smld, config)\n\nprintln(\"Connected $(info.n_input) → $(info.n_combined) localizations\")\nprintln(\"Formed $(info.n_tracks) tracks from $(info.n_preclusters) preclusters\")\n\n# Access track assignments for downstream analysis\ntrack_ids = [e.track_id for e in info.connected.emitters]\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.linkclusters!-Tuple{Vector{Int64}, Int64, Union{Int64, Vector{Int64}}, Vector{Int64}}","page":"Home","title":"SMLMFrameConnection.linkclusters!","text":"connectID, maxconnectID = linkclusters!(connectID::Int64, \n    maxconnectID::Int64, updateind::Vector{Int64}, \n    assignment::Vector{Int64})\n\nForce localizations linked by assignment to share same the same connectID\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.linkclusters-Tuple{Vector{Int64}, Int64, Union{Int64, Vector{Int64}}, Vector{Int64}}","page":"Home","title":"SMLMFrameConnection.linkclusters","text":"connectID, maxconnectID = linkclusters(\n    connectID::Int64, maxconnectID::Int64, \n    updateind::Vector{Int64}, assignment::Vector{Int64})\n\nForce localizations linked by assignment to share same the same connectID\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.organizeclusters-Union{Tuple{SMLMData.BasicSMLD{T, E}}, Tuple{E}, Tuple{T}} where {T, E<:SMLMData.AbstractEmitter}","page":"Home","title":"SMLMFrameConnection.organizeclusters","text":"clusterdata = organizeclusters(smld::BasicSMLD{T,E}) where {T, E<:SMLMData.AbstractEmitter}\n\nOrganize pre-clusters into a vector indexing distinct clusters.\n\nDescription\n\nPre-clusters in the input smld, as related by their shared integer value of track_id, are organized into a vector of matrices clusterdata.  Each index of clusterdata corresponds to a distinct cluster.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.precluster-Union{Tuple{SMLMData.BasicSMLD{T, E}}, Tuple{E}, Tuple{T}, Tuple{SMLMData.BasicSMLD{T, E}, ParamStruct}} where {T, E<:SMLMData.AbstractEmitter}","page":"Home","title":"SMLMFrameConnection.precluster","text":"smld_preclustered = precluster(smld::BasicSMLD{T,E},\n    params::ParamStruct = ParamStruct()) where {T, E<:SMLMData.AbstractEmitter}\n\nCluster localizations in smld based on distance and time thresholds in params.\n\nDescription\n\nLocalizations in the input structure smld are clustered together based on their spatiotemporal separations.  All localizations within a spatial threshold of params.max_sigma_dist*mean([σ_x σ_y]) and a temporal threshold of params.max_frame_gap of one another will be clustered together, meaning that these localizations now share the same unique integer value for their track_id field.\n\nNotes\n\nPre-clustering allows localizations observed in the same frame to be in the same cluster.  This is done to prevent exclusion of the \"correct\" localization from its ideal cluster due to a previously included \"incorrect\" localization into that cluster.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.solveLAP-Tuple{Matrix{Float32}}","page":"Home","title":"SMLMFrameConnection.solveLAP","text":"assignment, cost = solveLAP(costmatrix::Matrix{Float32})\n\nSolve the linear assignment problem designated by costmatrix.\n\nDescription\n\nSolve the linear assignment problem (LAP) defined by costmatrix using the package Hungarian.jl.  For now, this method is just a wrapper around  Hungarian.jl, however the intention is to add more checks and options to this method in the future.\n\n\n\n\n\n","category":"method"},{"location":"#SMLMFrameConnection.to_emitter2dfit-Tuple{SMLMData.AbstractEmitter, Int64}","page":"Home","title":"SMLMFrameConnection.to_emitter2dfit","text":"to_emitter2dfit(e::AbstractEmitter, track_id::Int) -> Emitter2DFit\n\nConvert any AbstractEmitter to Emitter2DFit with specified track_id. Used internally to support different input emitter types while producing consistent Emitter2DFit output.\n\n\n\n\n\n","category":"method"},{"location":"#Citation","page":"Home","title":"Citation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"David J. Schodt and Keith A. Lidke, \"Spatiotemporal Clustering of Repeated Super-Resolution Localizations via Linear Assignment Problem\", Frontiers in Bioinformatics, 2021. DOI: 10.3389/fbinf.2021.724325","category":"page"}]
}
